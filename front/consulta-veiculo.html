<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Consulta Veículo</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input { padding: 8px; width: 200px; }
    button { padding: 8px 12px; margin-left: 8px; }
    #modal, #mensagem { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; }
    #modal { background: #f1f8e9; }
    #mensagem { background: #ffebee; color: #b71c1c; }
    pre { white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>Consulta de Veículo por Placa</h2>
  <input type="text" id="placa" placeholder="Digite a placa">
  <button onclick="consultar()">Consultar</button>

  <div id="modal">
    <h3>Dados do Veículo:</h3>
    <pre id="resultado"></pre>
  </div>
  <div id="mensagem"></div>

  <script>
    async function consultar() {
      const placa = document.getElementById("placa").value.trim();
      if (!placa) return alert("Informe a placa.");

      const envelope = `<?xml version="1.0" encoding="utf-8"?>
        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                          xmlns:ser="http://service.seguradora.com.br/">
          <soapenv:Header/>
          <soapenv:Body>
            <ser:consultarVeiculoPorPlaca>
              <placa>${placa}</placa>
            </ser:consultarVeiculoPorPlaca>
          </soapenv:Body>
        </soapenv:Envelope>`;

      const res = await fetch("http://localhost:9090/proxy/veiculo", {
        method: "POST",
        headers: { "Content-Type": "text/xml;charset=UTF-8" },
        body: envelope
      });

      const text = await res.text();
      const json = text.match(/<return>(.*?)<\/return>/)?.[1];

      if (!json || json === "{}") mostrarErro("Veículo não encontrado.");
      else mostrarResultado(json);
    }

    function mostrarResultado(json) {
      document.getElementById("mensagem").style.display = "none";
      document.getElementById("resultado").textContent = JSON.stringify(JSON.parse(json), null, 2);
      document.getElementById("modal").style.display = "block";
    }

    function mostrarErro(msg) {
      document.getElementById("modal").style.display = "none";
      const m = document.getElementById("mensagem");
      m.textContent = msg;
      m.style.display = "block";
    }
  </script>
</body>
</html>
