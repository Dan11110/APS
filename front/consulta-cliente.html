<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Consulta Cliente</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input { padding: 8px; width: 200px; }
    button { padding: 8px 12px; margin-left: 8px; }
    #modal, #mensagem { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; }
    #modal { background: #e0f7fa; }
    #mensagem { background: #ffebee; color: #b71c1c; }
    pre { white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>Consulta de Cliente por CPF</h2>
  <input type="text" id="cpf" placeholder="Digite o CPF">
  <button onclick="consultar()">Consultar</button>

  <div id="modal">
    <h3>Dados do Cliente:</h3>
    <pre id="resultado"></pre>
  </div>
  <div id="mensagem"></div>

  <script>
    async function consultar() {
      const cpf = document.getElementById("cpf").value.trim();
      if (!cpf) return alert("Informe o CPF.");

      const envelope = `<?xml version="1.0" encoding="utf-8"?>
        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                          xmlns:ser="http://service.seguradora.com.br/">
          <soapenv:Header/>
          <soapenv:Body>
            <ser:consultarClientePorCPF>
              <cpf>${cpf}</cpf>
            </ser:consultarClientePorCPF>
          </soapenv:Body>
        </soapenv:Envelope>`;

      const res = await fetch("http://localhost:9090/proxy/cliente", {
        method: "POST",
        headers: {
            "Content-Type": "text/xml;charset=UTF-8",
            "X-System-Name": "consulta-cliente"
        },
        body: envelope
      });

      const text = await res.text();
      const json = text.match(/<return>(.*?)<\/return>/)?.[1];

      if (!json || json === "{}") mostrarErro("Cliente n√£o encontrado.");
      else mostrarResultado(json);
    }

    function mostrarResultado(json) {
      document.getElementById("mensagem").style.display = "none";
      document.getElementById("resultado").textContent = JSON.stringify(JSON.parse(json), null, 2);
      document.getElementById("modal").style.display = "block";
    }

    function mostrarErro(msg) {
      document.getElementById("modal").style.display = "none";
      const m = document.getElementById("mensagem");
      m.textContent = msg;
      m.style.display = "block";
    }
  </script>
</body>
</html>
